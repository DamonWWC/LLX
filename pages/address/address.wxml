<!--pages/address/address.wxml-->
<view class="container">
  <!-- 地址列表 -->
  <scroll-view class="address-list" scroll-y wx:if="{{addressList.length > 0}}">
    <view class="address-item" wx:for="{{addressList}}" wx:key="id" bindtap="selectAddress" data-id="{{item.id}}">
      <!-- 默认标签 -->
      <view class="default-badge" wx:if="{{item.isDefault}}">默认</view>
      
      <!-- 地址信息 -->
      <view class="address-info">
        <view class="address-header">
          <text class="receiver-name">{{item.name}}</text>
          <text class="receiver-phone">{{item.phone}}</text>
        </view>
        <view class="address-detail">
          {{item.province}} {{item.city}} {{item.district}} {{item.detail}}
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="address-actions" catchtap="stopPropagation">
        <view class="action-btn edit-btn" catchtap="showEditDialogHandler" data-id="{{item.id}}">
          <text>编辑</text>
        </view>
        <view class="action-btn delete-btn" catchtap="deleteAddress" data-id="{{item.id}}">
          <text>删除</text>
        </view>
        <view class="action-btn default-btn" catchtap="setDefaultAddress" data-id="{{item.id}}" wx:if="{{!item.isDefault}}">
          <text>设为默认</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{addressList.length === 0}}">
    <text class="empty-icon">📍</text>
    <text class="empty-text">还没有收货地址</text>
    <text class="empty-hint">快去添加一个吧~</text>
  </view>

  <!-- 底部添加按钮 -->
  <view class="bottom-bar">
    <button class="add-address-btn" bindtap="showAddDialog">
      <text class="btn-icon">+</text>
      <text>添加新地址</text>
    </button>
  </view>

  <!-- 编辑/添加地址弹窗 -->
  <view class="modal-mask" wx:if="{{showEditDialog}}" bindtap="closeEditDialog"></view>
  <view class="modal-dialog" wx:if="{{showEditDialog}}">
    <view class="modal-header">
      <text class="modal-title">{{editingAddress ? '编辑地址' : '添加地址'}}</text>
      <text class="modal-close" bindtap="closeEditDialog">×</text>
    </view>

    <view class="modal-content">
      <!-- 智能识别按钮 -->
      <view class="smart-paste-btn" bindtap="showPasteDialogHandler">
        <text class="paste-icon">📋</text>
        <text class="paste-text">智能识别粘贴</text>
        <text class="paste-hint">支持识别姓名、电话、地址</text>
      </view>

      <!-- 表单 -->
      <view class="form-item">
        <view class="form-label">
          <text class="required">*</text>
          <text>收件人</text>
        </view>
        <input 
          class="form-input" 
          placeholder="请输入收件人姓名" 
          value="{{formName}}"
          bindinput="onNameInput"
        />
      </view>

      <view class="form-item">
        <view class="form-label">
          <text class="required">*</text>
          <text>手机号</text>
        </view>
        <input 
          class="form-input" 
          type="number"
          maxlength="11"
          placeholder="请输入手机号码" 
          value="{{formPhone}}"
          bindinput="onPhoneInput"
        />
      </view>

      <view class="form-item">
        <view class="form-label">
          <text class="required">*</text>
          <text>省份</text>
        </view>
        <input 
          class="form-input" 
          placeholder="例如: 北京市" 
          value="{{formProvince}}"
          bindinput="onProvinceInput"
        />
      </view>

      <view class="form-item">
        <view class="form-label">
          <text class="required">*</text>
          <text>城市</text>
        </view>
        <input 
          class="form-input" 
          placeholder="例如: 北京市" 
          value="{{formCity}}"
          bindinput="onCityInput"
        />
      </view>

      <view class="form-item">
        <view class="form-label">
          <text>区/县</text>
        </view>
        <input 
          class="form-input" 
          placeholder="例如: 朝阳区" 
          value="{{formDistrict}}"
          bindinput="onDistrictInput"
        />
      </view>

      <view class="form-item">
        <view class="form-label">
          <text class="required">*</text>
          <text>详细地址</text>
        </view>
        <textarea 
          class="form-textarea" 
          placeholder="请输入详细地址（街道、门牌号等）" 
          value="{{formDetail}}"
          bindinput="onDetailInput"
          maxlength="200"
        ></textarea>
      </view>

      <view class="form-item-checkbox">
        <checkbox-group bindchange="onDefaultChange">
          <label class="checkbox-label">
            <checkbox value="default" checked="{{formIsDefault}}"/>
            <text>设为默认地址</text>
          </label>
        </checkbox-group>
      </view>
    </view>

    <view class="modal-footer">
      <button class="modal-btn cancel" bindtap="closeEditDialog">取消</button>
      <button class="modal-btn confirm" bindtap="saveAddress">保存</button>
    </view>
  </view>

  <!-- 智能粘贴弹窗 -->
  <view class="modal-mask" wx:if="{{showPasteDialog}}" bindtap="closePasteDialog"></view>
  <view class="paste-dialog" wx:if="{{showPasteDialog}}">
    <view class="paste-header">
      <text class="paste-title">粘贴地址信息</text>
      <text class="paste-close" bindtap="closePasteDialog">×</text>
    </view>
    
    <view class="paste-content">
      <textarea 
        class="paste-textarea" 
        placeholder="粘贴地址信息，例如：&#10;张三 13800138000&#10;北京市朝阳区xxx街道xxx号" 
        value="{{pasteText}}"
        bindinput="onPasteTextInput"
        maxlength="500"
        auto-height
      ></textarea>
      <view class="paste-tip">
        💡 支持自动识别姓名、手机号、省市区、详细地址
      </view>
    </view>

    <view class="paste-footer">
      <button class="paste-btn" bindtap="parseAddressText">智能识别</button>
    </view>
  </view>
</view>

