<!--pages/checkout/checkout.wxml-->
<view class="checkout-container">
  <!-- 主要内容 -->
  <view class="checkout-content">
    <!-- 收货地址 -->
    <view class="address-section" bindtap="selectAddress">
      <view class="address-header-row">
        <text class="address-title">📍 收货地址</text>
        <text class="address-action">{{selectedAddress ? '更换' : '选择'}} ></text>
      </view>
      <view class="address-content" wx:if="{{selectedAddress}}">
        <view class="address-info-row">
          <text class="address-name">{{selectedAddress.name}}</text>
          <text class="address-phone">{{selectedAddress.phone}}</text>
        </view>
        <view class="address-detail-text">
          {{selectedAddress.province}} {{selectedAddress.city}} {{selectedAddress.district}} {{selectedAddress.detail}}
        </view>
      </view>
      <view class="address-empty" wx:else>
        <text class="empty-hint-text">请选择收货地址</text>
      </view>
    </view>

    <view class="divider"></view>

    <!-- 已选商品明细 -->
    <view class="products-section">
      <view class="section-title">商品明细</view>
      <view class="product-item" wx:for="{{selectedProducts}}" wx:key="id" wx:for-index="idx">
        <view class="product-info">
          <view class="product-name">{{idx + 1}}.{{item.name}}（{{item.weight}}斤/{{item.unit}}）单价：{{item.price}}元</view>
          <view class="product-detail">数量：{{item.quantity}}{{item.unit}} ，总重：{{item.quantity * item.weight}}斤 ，总价：{{item.subtotal}}元</view>
        </view>
      </view>
    </view>

    <view class="divider"></view>

    <!-- 汇总信息 -->
    <view class="summary-section">
      <view class="summary-row">
        <text class="summary-label">商品总价</text>
        <text class="summary-value">¥{{totalRicePrice}}</text>
      </view>
      <view class="summary-row">
        <text class="summary-label">总重量</text>
        <text class="summary-value">{{totalWeight}}斤</text>
      </view>
      <view class="summary-row" wx:if="{{selectedAddress}}">
        <text class="summary-label">运费 ({{shippingRate}}元/斤)</text>
        <text class="summary-value">¥{{totalShipping}}</text>
      </view>
      <view class="summary-row" wx:else>
        <text class="summary-label">运费</text>
        <text class="summary-value hint">请先选择地址</text>
      </view>
      <view class="summary-row total">
        <text class="summary-label">应付总额</text>
        <text class="summary-value grand">¥{{grandTotal}}</text>
      </view>
    </view>

    <view class="divider"></view>

    <!-- 付款状态选择 -->
    <view class="payment-status-section">
      <view class="section-title">付款状态</view>
      <view class="payment-options">
        <view class="payment-option {{paymentStatus === '已付款' ? 'selected' : ''}}" bindtap="selectPaymentStatus" data-status="已付款">
          <view class="option-icon">✅</view>
          <view class="option-content">
            <text class="option-title">已付款</text>
            <text class="option-desc">订单将直接进入待发货状态</text>
          </view>
          <view class="option-radio {{paymentStatus === '已付款' ? 'checked' : ''}}"></view>
        </view>
        <view class="payment-option {{paymentStatus === '未付款' ? 'selected' : ''}}" bindtap="selectPaymentStatus" data-status="未付款">
          <view class="option-icon">⏰</view>
          <view class="option-content">
            <text class="option-title">未付款</text>
            <text class="option-desc">订单将进入待付款状态</text>
          </view>
          <view class="option-radio {{paymentStatus === '未付款' ? 'checked' : ''}}"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- 底部提交按钮 -->
  <view class="submit-bar">
    <view class="total-info">
      <text class="total-label">合计：</text>
      <text class="total-price">¥{{grandTotal}}</text>
    </view>
    <button class="submit-btn" bindtap="confirmOrder">
      提交订单
    </button>
  </view>

  <!-- 隐藏的Canvas用于生成图片（如需要） -->
  <canvas 
    type="2d" 
    id="resultCanvas" 
    class="result-canvas"
    style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
  ></canvas>
</view>

