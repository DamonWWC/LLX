<!--pages/checkout/checkout.wxml-->
<view class="checkout-container">
  <!-- ä¸»è¦å†…å®¹ -->
  <view class="checkout-content">
    <!-- æ”¶è´§åœ°å€ -->
    <view class="address-section" bindtap="selectAddress">
      <view class="address-header-row">
        <text class="address-title">ğŸ“ æ”¶è´§åœ°å€</text>
        <text class="address-action">{{selectedAddress ? 'æ›´æ¢' : 'é€‰æ‹©'}} ></text>
      </view>
      <view class="address-content" wx:if="{{selectedAddress}}">
        <view class="address-info-row">
          <text class="address-name">{{selectedAddress.name}}</text>
          <text class="address-phone">{{selectedAddress.phone}}</text>
        </view>
        <view class="address-detail-text">
          {{selectedAddress.province}} {{selectedAddress.city}} {{selectedAddress.district}} {{selectedAddress.detail}}
        </view>
      </view>
      <view class="address-empty" wx:else>
        <text class="empty-hint-text">è¯·é€‰æ‹©æ”¶è´§åœ°å€</text>
      </view>
    </view>

    <view class="divider"></view>

    <!-- å·²é€‰å•†å“æ˜ç»† -->
    <view class="products-section">
      <view class="section-title">å•†å“æ˜ç»†</view>
      <view class="product-item" wx:for="{{selectedProducts}}" wx:key="id">
        <view class="product-name">{{item.name}} Ã— {{item.quantity}}</view>
        <view class="product-price">Â¥{{item.subtotal}}</view>
      </view>
    </view>

    <view class="divider"></view>

    <!-- æ±‡æ€»ä¿¡æ¯ -->
    <view class="summary-section">
      <view class="summary-row">
        <text class="summary-label">å•†å“æ€»ä»·</text>
        <text class="summary-value">Â¥{{totalRicePrice}}</text>
      </view>
      <view class="summary-row">
        <text class="summary-label">æ€»é‡é‡</text>
        <text class="summary-value">{{totalWeight}}æ–¤</text>
      </view>
      <view class="summary-row" wx:if="{{selectedAddress}}">
        <text class="summary-label">è¿è´¹ ({{shippingRate}}å…ƒ/æ–¤)</text>
        <text class="summary-value">Â¥{{totalShipping}}</text>
      </view>
      <view class="summary-row" wx:else>
        <text class="summary-label">è¿è´¹</text>
        <text class="summary-value hint">è¯·å…ˆé€‰æ‹©åœ°å€</text>
      </view>
      <view class="summary-row total">
        <text class="summary-label">åº”ä»˜æ€»é¢</text>
        <text class="summary-value grand">Â¥{{grandTotal}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æäº¤æŒ‰é’® -->
  <view class="submit-bar">
    <view class="total-info">
      <text class="total-label">åˆè®¡ï¼š</text>
      <text class="total-price">Â¥{{grandTotal}}</text>
    </view>
    <button class="submit-btn" bindtap="confirmOrder">
      æäº¤è®¢å•
    </button>
  </view>

  <!-- éšè—çš„Canvasç”¨äºç”Ÿæˆå›¾ç‰‡ï¼ˆå¦‚éœ€è¦ï¼‰ -->
  <canvas 
    type="2d" 
    id="resultCanvas" 
    class="result-canvas"
    style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
  ></canvas>
</view>

