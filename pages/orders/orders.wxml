<!--pages/orders/orders.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="è¾“å…¥å§“åæˆ–ç”µè¯æœç´¢è®¢å•" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
        confirm-type="search"
      />
      <view class="clear-btn" wx:if="{{searchKeyword}}" bindtap="clearSearch">
        <text>âœ•</text>
      </view>
    </view>
    
    <!-- å¤šé€‰æ¨¡å¼åˆ‡æ¢ -->
    <view class="multi-select-toggle" bindtap="toggleMultiSelectMode">
      <text class="toggle-text">{{isMultiSelectMode ? 'å–æ¶ˆå¤šé€‰' : 'å¤šé€‰è®¢å•'}}</text>
    </view>
  </view>

  <!-- æœç´¢ç»“æœæç¤º -->
  <view class="search-result-tip" wx:if="{{isSearching && filteredOrderList.length === 0}}">
    <text class="tip-icon">ğŸ”</text>
    <text class="tip-text">æœªæ‰¾åˆ°ç›¸å…³è®¢å•</text>
    <text class="tip-hint">è¯·æ£€æŸ¥å§“åæˆ–ç”µè¯æ˜¯å¦æ­£ç¡®</text>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <scroll-view class="order-list" scroll-y wx:if="{{filteredOrderList.length > 0}}">
    <view class="order-item {{item.selected ? 'selected' : ''}}" wx:for="{{filteredOrderList}}" wx:key="id" bindtap="{{isMultiSelectMode ? 'toggleOrderSelection' : 'viewOrderDetail'}}" data-orderid="{{item.id}}">
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="order-header-left">
          <view class="checkbox" wx:if="{{isMultiSelectMode}}" bindtap="toggleOrderSelection" data-orderid="{{item.id}}" catchtap="preventBubble">
            <text class="checkbox-icon {{item.selected ? 'checked' : ''}}">{{item.selected ? 'âœ“' : ''}}</text>
          </view>
          <text class="order-no">è®¢å•å·ï¼š{{item.orderNo}}</text>
        </view>
        <text class="order-status">{{item.status}}</text>
      </view>

      <!-- è®¢å•å†…å®¹ -->
      <view class="order-content">
        <!-- æ”¶è´§ä¿¡æ¯ -->
        <view class="order-address">
          <text class="address-icon">ğŸ“</text>
          <text class="address-text">{{item.address.name}} {{item.address.phone}}</text>
        </view>

        <!-- è®¢å•é‡‘é¢å’Œä»˜æ¬¾çŠ¶æ€ -->
        <view class="order-price-status">
          <view class="order-price">
            <text class="price-label">å®ä»˜æ¬¾ï¼š</text>
            <text class="price-value">Â¥{{item.grandTotal}}</text>
          </view>
          
          <!-- ä»˜æ¬¾çŠ¶æ€ - å³ä¾§ -->
          <view class="order-payment-status" wx:if="{{item.paymentStatus}}">
            <text class="payment-label">ä»˜æ¬¾çŠ¶æ€ï¼š</text>
            <text class="payment-status {{item.paymentStatus === 'å·²ä»˜æ¬¾' ? 'paid' : 'unpaid'}}">{{item.paymentStatus}}</text>
          </view>
        </view>

        <!-- å¿«é€’ä¿¡æ¯ -->
        <view class="shipping-info" wx:if="{{item.trackingNumber}}">
          <text class="shipping-icon">ğŸ“¦</text>
          <text class="shipping-label">å¿«é€’å•å·ï¼š</text>
          <text class="tracking-number">{{item.trackingNumber}}</text>
        </view>

        <!-- å‘è´§æ—¶é—´ -->
        <view class="shipping-time" wx:if="{{item.shippingTime}}">
          <text class="shipping-time-label">å‘è´§æ—¶é—´ï¼š</text>
          <text class="shipping-time-value">{{item.shippingTime}}</text>
        </view>

        <!-- è®¢å•æ—¶é—´ -->
        <view class="order-time">
          <text>{{item.createTime}}</text>
        </view>
      </view>

      <!-- è®¢å•æ“ä½œ -->
      <view class="order-actions" catchtap="preventBubble">
        <!-- æ›´å¤šæŒ‰é’® - æœ€å·¦ä¾§ -->
        <view class="more-btn-wrapper">
          <view class="action-btn more-btn" bindtap="toggleMoreMenu" data-orderid="{{item.id}}">
            <text>æ›´å¤š</text>
            <text class="arrow {{item.showMoreMenu ? 'up' : 'down'}}">â–¼</text>
          </view>
          
          <!-- æ›´å¤šèœå• -->
          <view class="more-menu {{item.showMoreMenu ? 'show' : ''}}" wx:if="{{item.showMoreMenu}}">
            <view class="more-menu-item" bindtap="shareOrder" data-orderid="{{item.id}}">
              <text>åˆ†äº«</text>
            </view>
            <view class="more-menu-item delete" bindtap="deleteOrder" data-orderid="{{item.id}}">
              <text>åˆ é™¤</text>
            </view>
          </view>
        </view>
        
        <view class="action-btn export" bindtap="exportOrderImage" data-orderid="{{item.id}}">
          <text>è®¢å•</text>
        </view>
        <view class="action-btn export-shipping" bindtap="exportShippingList" data-orderid="{{item.id}}">
          <text>å‘è´§å•</text>
        </view>
        <view class="action-btn tracking-btn" bindtap="editTrackingNumber" data-orderid="{{item.id}}" wx:if="{{item.status === 'å·²å‘è´§'}}">
          <text>å¿«é€’å•å·</text>
        </view>
        
        <!-- çŠ¶æ€æ›´æ–°æŒ‰é’® - æœ€å³ä¾§ -->
        <view class="action-btn status-update" bindtap="updateOrderStatus" data-orderid="{{item.id}}" data-current-status="{{item.status}}" wx:if="{{item.status === 'å¾…ä»˜æ¬¾'}}">
          <text>ç¡®è®¤ä»˜æ¬¾</text>
        </view>
        <view class="action-btn status-update" bindtap="updateOrderStatus" data-orderid="{{item.id}}" data-current-status="{{item.status}}" wx:if="{{item.status === 'å¾…å‘è´§'}}">
          <text>ç¡®è®¤å‘è´§</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!isSearching && orderList.length === 0}}">
    <text class="empty-icon">ğŸ“¦</text>
    <text class="empty-text">è¿˜æ²¡æœ‰è®¢å•</text>
    <text class="empty-hint">å»å•†å“é¡µé¢é€‰è´­å§~</text>
  </view>

  <!-- è¿‡æ»¤åæ— ç»“æœçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!isSearching && orderList.length > 0 && filteredOrderList.length === 0}}">
    <text class="empty-icon">ğŸ“¦</text>
    <text class="empty-text">æš‚æ— {{filterStatus}}è®¢å•</text>
    <text class="empty-hint">å½“å‰æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è®¢å•</text>
  </view>

  <!-- å¤šé€‰æ¨¡å¼åº•éƒ¨æ“ä½œæ  -->
  <view class="multi-select-bottom-bar" wx:if="{{isMultiSelectMode && selectedOrders.length > 0}}">
    <view class="selected-info">
      <text class="selected-count">å·²é€‰æ‹© {{selectedOrders.length}} ä¸ªè®¢å•</text>
      <text class="total-amount">åˆè®¡ï¼šÂ¥{{totalAmount}}</text>
    </view>
  </view>

  <!-- åº•éƒ¨æ¸…ç©ºæŒ‰é’® -->
  <view class="bottom-bar" wx:if="{{orderList.length > 0 && !isMultiSelectMode}}">
    <button class="clear-all-btn" bindtap="clearAllOrders">
      <text class="btn-icon">ğŸ—‘ï¸</text>
      <text>æ¸…ç©ºæ‰€æœ‰è®¢å•</text>
    </button>
  </view>

  <!-- éšè—çš„Canvasç”¨äºç”Ÿæˆè®¢å•å›¾ç‰‡ -->
  <canvas 
    type="2d" 
    id="orderCanvas" 
    class="order-canvas"
    style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
  ></canvas>
</view>

