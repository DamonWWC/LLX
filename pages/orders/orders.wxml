<!--pages/orders/orders.wxml-->
<view class="container">
  <!-- è®¢å•åˆ—è¡¨ -->
  <scroll-view class="order-list" scroll-y wx:if="{{orderList.length > 0}}">
    <view class="order-item" wx:for="{{orderList}}" wx:key="id">
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <text class="order-no">è®¢å•å·ï¼š{{item.orderNo}}</text>
        <text class="order-status">{{item.status}}</text>
      </view>

      <!-- è®¢å•å†…å®¹ -->
      <view class="order-content">
        <!-- å•†å“ä¿¡æ¯ -->
        <view class="order-products">
          <view class="product-item" wx:for="{{item.products}}" wx:key="id" wx:for-item="product" wx:for-index="idx">
            <text class="product-name">{{idx + 1}}.{{product.name}}ï¼ˆ{{product.weight}}æ–¤/{{product.unit}}ï¼‰å•ä»·ï¼š{{product.price}}å…ƒ</text>
            <text class="product-detail">æ•°é‡ï¼š{{product.quantity}}{{product.unit}} ï¼Œæ€»é‡ï¼š{{product.quantity * product.weight}}æ–¤ ï¼Œæ€»ä»·ï¼š{{product.subtotal}}å…ƒ</text>
          </view>
        </view>

        <!-- æ”¶è´§åœ°å€ -->
        <view class="order-address">
          <text class="address-icon">ğŸ“</text>
          <text class="address-text">{{item.address.name}} {{item.address.phone}}</text>
        </view>

        <!-- è®¢å•é‡‘é¢ -->
        <view class="order-price">
          <text class="price-label">å®ä»˜æ¬¾ï¼š</text>
          <text class="price-value">Â¥{{item.grandTotal}}</text>
        </view>

        <!-- è®¢å•æ—¶é—´ -->
        <view class="order-time">
          <text>{{item.createTime}}</text>
        </view>
      </view>

      <!-- è®¢å•æ“ä½œ -->
      <view class="order-actions">
        <view class="action-btn" bindtap="viewOrderDetail" data-orderid="{{item.id}}">
          <text>æŸ¥çœ‹è¯¦æƒ…</text>
        </view>
        <view class="action-btn export" bindtap="exportOrderImage" data-orderid="{{item.id}}">
          <text>ğŸ“¥ è®¢å•</text>
        </view>
        <view class="action-btn export-shipping" bindtap="exportShippingList" data-orderid="{{item.id}}">
          <text>ğŸ“‹ å‘è´§å•</text>
        </view>
        <view class="action-btn share" bindtap="shareOrder" data-orderid="{{item.id}}">
          <text>ğŸ“¤ åˆ†äº«</text>
        </view>
        <view class="action-btn delete" bindtap="deleteOrder" data-orderid="{{item.id}}">
          <text>åˆ é™¤</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{orderList.length === 0}}">
    <text class="empty-icon">ğŸ“¦</text>
    <text class="empty-text">è¿˜æ²¡æœ‰è®¢å•</text>
    <text class="empty-hint">å»å•†å“é¡µé¢é€‰è´­å§~</text>
  </view>

  <!-- åº•éƒ¨æ¸…ç©ºæŒ‰é’® -->
  <view class="bottom-bar" wx:if="{{orderList.length > 0}}">
    <button class="clear-all-btn" bindtap="clearAllOrders">
      <text class="btn-icon">ğŸ—‘ï¸</text>
      <text>æ¸…ç©ºæ‰€æœ‰è®¢å•</text>
    </button>
  </view>

  <!-- éšè—çš„Canvasç”¨äºç”Ÿæˆè®¢å•å›¾ç‰‡ -->
  <canvas 
    type="2d" 
    id="orderCanvas" 
    class="order-canvas"
    style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
  ></canvas>
</view>

