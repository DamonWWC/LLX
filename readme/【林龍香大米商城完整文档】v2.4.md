# 林龍香大米商城 - 完整项目文档 v2.4

## 📋 目录

1. [项目介绍](#项目介绍)
2. [快速开始](#快速开始)
3. [v2.4 最新更新](#v24-最新更新)
4. [核心功能详解](#核心功能详解)
5. [使用指南](#使用指南)
6. [技术实现](#技术实现)
7. [测试用例](#测试用例)
8. [常见问题](#常见问题)
9. [版本历史](#版本历史)

---

## 项目介绍

### 概述
林龍香大米商城是一个功能完整的微信小程序，专为大米销售业务设计，提供商品管理、购物车、订单管理、地址智能识别、发货单导出等完整功能。

### 主要特性
✅ **商品管理** - 支持添加、编辑、删除商品，自定义图片
✅ **智能购物车** - 便捷的加减数量操作，实时保存
✅ **地址智能识别 v2.2** - 增强算法，支持任意顺序地址识别
✅ **订单管理系统** - 完整的订单生命周期，支持状态筛选和搜索
✅ **快递单号管理** - 发货时记录快递单号，支持编辑
✅ **发货单导出** - 两种导出方式（完整订单/发货单）
✅ **运费智能计算** - 基于省份和重量的运费配置系统
✅ **云端存储** - 所有数据存储在云端数据库，多端同步
✅ **订单详情页** - 独立页面显示完整订单信息
✅ **多选订单功能** - 批量计算订单总金额
✅ **API 集成** - 完整的后端服务接口对接
✅ **运费 API** - 运费通过后端 API 动态计算
✅ **批量删除** - 支持批量删除订单功能

---

## 快速开始

### 环境要求
- 微信开发者工具
- 基础库版本 2.10.0+
- Node.js（可选）

### 安装步骤

1. **克隆项目**
```bash
git clone [项目地址]
cd LLX-SmallProgram
```

2. **打开项目**
   - 启动微信开发者工具
   - 选择"导入项目"
   - 选择项目目录

3. **开始使用**
   - 点击"编译"按钮
   - 即可在模拟器中预览

### 第一次使用
1. 浏览商品列表
2. 点击 + - 按钮调整商品数量
3. 点击"去结算"进入结算页
4. 添加收货地址
5. 提交订单

---

## v2.4 最新更新

### 🎉 重大更新（2025-10-17）

#### 1. 订单管理系统增强 ⭐⭐⭐⭐
**新增功能**：
- **订单状态筛选** - 按"待付款"、"待发货"、"已发货"筛选
- **订单搜索功能** - 支持按收货人姓名或电话搜索
- **快递单号管理** - 发货时添加快递单号，支持后续编辑
- **多选订单功能** - 可选择多个订单，显示总金额
- **订单详情页** - 独立页面显示完整订单信息

**使用场景**：
```
场景1：查看待发货订单
"我的" → "待发货" → 自动筛选待发货订单

场景2：搜索客户订单
"我的" → 输入客户姓名/电话 → 实时搜索

场景3：批量统计
订单页面 → 开启多选模式 → 选择订单 → 查看总金额
```

#### 2. 运费计算系统优化 ⭐⭐⭐⭐
**运费配置方式**：
- **基于省份** - 不同省份运费单价不同
- **分区域配置** - 东北/华北/华东/华南/西北/西南/偏远
- **实时计算** - 根据总重量和运费单价自动计算

**运费标准**：
```javascript
东北地区（黑吉辽）：1.0元/斤
华北地区（京津冀鲁晋蒙豫）：1.2元/斤
华东地区（沪苏浙皖闽赣）：1.4元/斤
华南地区（粤桂琼）：1.4元/斤
华中地区（鄂湘）：1.4元/斤
西南地区（渝川黔滇）：1.4元/斤
西北地区（陕甘宁）：1.4元/斤
偏远地区（藏青新）：5.4元/斤
```

**计算示例**：
```
商品：长粒香 2袋 × 10斤 = 20斤
地址：黑龙江省
运费单价：1.0元/斤
运费总计：20 × 1.0 = 20元
```

#### 3. 地址智能识别增强 v2.2 ⭐⭐⭐⭐
**核心改进**：
- **无序识别** - 支持任意顺序的姓名、电话、地址组合
- **多策略提取** - 6种姓名提取策略，识别率大幅提升
- **直辖市优化** - 正确处理北京、天津、上海、重庆的城市名称
- **遮蔽号码支持** - 识别并提示修改遮蔽手机号（如：138****0000）

**支持格式示例**：
```
格式1：姓名 + 电话 + 地址
张三 13800138000 广东省深圳市南山区科技园南路1号

格式2：电话 + 地址 + 姓名
13800138000 广东省深圳市南山区科技园南路1号 张三

格式3：地址 + 姓名 + 电话
广东省深圳市南山区科技园南路1号 张三 13800138000

格式4：带标签
收件人：张三
电话：13800138000
地址：广东省深圳市南山区科技园南路1号
```

#### 4. 订单状态流转管理 ⭐⭐⭐
**状态流程**：
```
待付款 → 待发货 → 已发货
```

**操作说明**：
- **确认付款** - 将"待付款"更新为"待发货"，同时更新付款状态
- **确认发货** - 输入快递单号，更新为"已发货"
- **编辑快递单号** - 已发货订单可随时编辑快递单号

**快递单号显示条件**：
- 订单状态为"已发货"
- 且已填写快递单号

#### 5. Canvas动态高度优化 ⭐⭐⭐
**技术实现**：
```javascript
// 智能预估初始高度
const estimatedHeight = Math.max(3000, 800 + products.length * 100)

// 第一次绘制，获取实际高度
const actualHeight = await drawContent(ctx, order, estimatedHeight)

// 使用实际高度重新绘制
canvas.height = actualHeight * dpr
await drawContent(ctx, order, actualHeight)
```

**效果**：
- ✅ 支持任意数量商品完整显示
- ✅ 长地址自动换行不截断
- ✅ 动态计算行数和间距

#### 6. 云端数据存储 ⭐⭐⭐
**数据库存储**：
- **商品数据** - 存储在 `products` 数据表
- **订单数据** - 存储在 `orders` 数据表
- **地址数据** - 存储在 `addresses` 数据表
- **运费配置** - 存储在 `shipping_rates` 数据表
- **数据同步** - 多端实时同步，自动备份

**触发时机**：
- 首次加载商品数据时
- 检测到旧版数据格式时

#### 7. 用户体验优化 ⭐⭐
**导航栏优化**：
- 订单页面标题动态显示（显示当前筛选状态）
- 下拉菜单整合功能按钮
- 编辑模式防止误删

**交互优化**：
- 付款状态选择（结算页）
- 智能粘贴键盘遮挡优化
- 订单更多菜单（导出、分享、编辑等）

#### 8. 发货单功能完善 ⭐⭐
**两种导出方式**：
```
📥 订单图片
- 包含所有价格信息
- 适合给客户确认

📋 发货单
- 不含价格信息
- 仅显示商品和数量
- 适合给仓库/物流
```

**商品明细格式**：
```
1.长粒香（10斤/袋）单价：30元
   数量：2袋 ，总重：20斤 ，总价：60元
```

---

## 核心功能详解

### 1. 商品管理

#### 商品展示
- 📦 商品图片（SVG或自定义图片）
- 💰 价格和单位（袋/箱）
- ⚖️ 重量信息（斤/单位）
- 🔢 数量控制（加减按钮）

#### 添加商品
**步骤**：
1. 点击右上角工具图标（⚙）
2. 选择"添加品种"
3. 输入商品信息
   - 名称
   - 单价
   - 单位（袋/箱）
   - 重量（斤）
   - 选择图片（可选）
4. 点击"确定添加"

#### 编辑模式
**使用方法**：
1. 点击工具图标
2. 选择"编辑商品"
3. 商品右上角显示删除按钮
4. 点击删除按钮删除商品
5. 再次点击"完成编辑"退出

#### 恢复默认
- 点击工具图标
- 选择"恢复默认"
- 恢复系统默认的4种大米

### 2. 购物车功能

#### 数量调整
- **减少**：点击 - 按钮
- **增加**：点击 + 按钮
- 自动保存到本地存储

#### 清空购物车
- 在底部点击"清空"按钮
- 确认后清空所有商品数量

### 3. 地址智能识别 v2.2

#### 支持格式

**标准格式**：
```
张三 13800138000
广东省深圳市南山区科技园南路1号
```

**紧凑格式**：
```
李四13900139000广东广州天河区天河路100号
```

**复杂格式**：
```
收货人：王五
电话：13700137000
地址：北京市朝阳区建国路88号SOHO现代城
```

#### 识别规则
1. **姓名识别**
   - 2-4个汉字
   - 支持"先生"、"女士"后缀

2. **电话识别**
   - 11位手机号
   - 固定电话（带区号）

3. **地址识别**
   - 省市区自动分离
   - 详细地址提取
   - 支持模糊匹配

#### 使用方法
1. 点击"添加收货地址"
2. 粘贴完整地址文本
3. 点击"智能识别"
4. 检查识别结果
5. 手动修正（如需要）
6. 保存地址

### 4. 订单管理系统

#### 创建订单
**完整流程**：
```
选择商品 → 调整数量 → 去结算 → 选择收货地址 
   ↓
选择付款状态（已付款/未付款） → 确认信息 → 提交订单
```

**付款状态说明**：
- **未付款** - 订单状态为"待付款"
- **已付款** - 订单状态为"待发货"

#### 订单状态管理
**状态流转**：
```
待付款 → [确认付款] → 待发货 → [确认发货] → 已发货
```

**操作方式**：
1. **确认付款**
   - 点击"确认付款"按钮
   - 订单状态：待付款 → 待发货
   - 付款状态：未付款 → 已付款

2. **确认发货**
   - 点击"确认发货"按钮
   - 输入快递单号（可选）
   - 订单状态：待发货 → 已发货
   - 记录发货时间

3. **编辑快递单号**
   - 已发货订单可随时编辑快递单号
   - 点击"✏️"图标
   - 输入或修改快递单号

#### 订单筛选与搜索
**按状态筛选**：
- 在"我的"页面点击状态卡片
- 自动筛选对应状态的订单
- 支持：待付款、待发货、已发货、全部

**按客户搜索**：
- 输入客户姓名或电话
- 实时搜索订单
- 支持模糊匹配

#### 查看订单详情
**两种方式**：
1. **订单卡片点击**
   - 直接点击订单卡片
   - 跳转到独立详情页面
   - 显示完整订单信息

2. **快速查看**
   - 订单卡片上直接显示关键信息
   - 收货人、电话、地址
   - 商品明细、价格

#### 订单详情内容
- **订单基本信息**
  - 订单号
  - 订单状态
  - 下单时间
  
- **收货信息**
  - 收货人姓名
  - 联系电话
  - 详细地址
  
- **商品明细**
  - 商品名称（重量/单位）
  - 单价、数量、总重
  - 小计金额
  
- **价格汇总**
  - 商品总价
  - 总重量
  - 运费（运费单价）
  - 实付款

- **物流信息**（已发货订单）
  - 快递单号
  - 发货时间

#### 多选订单功能
**使用场景**：批量统计订单金额

**操作步骤**：
1. 点击顶部"多选"按钮
2. 勾选需要统计的订单
3. 底部显示：
   - 已选订单数量
   - 订单总金额
4. 点击"取消多选"退出

#### 导出订单
**三种方式**：

1. **📥 订单图片**
   - 包含所有价格信息
   - 适合给客户查看或确认
   - 点击"📥 订单"按钮

2. **📋 发货单**
   - 不含价格和运费信息
   - 仅显示商品、数量、总重
   - 适合给仓库或物流使用
   - 点击"📋 发货单"按钮

3. **📤 分享订单**
   - 生成订单图片
   - 直接分享到微信
   - 点击"📤 分享"按钮

#### 订单操作
- **删除订单** - 点击"删除"按钮（需确认）
- **更新状态** - 确认付款/确认发货
- **编辑快递单号** - 发货后可编辑
- **导出图片** - 保存到相册
- **分享订单** - 分享到微信

### 5. 发货单功能

#### 发货单内容
```
━━━━━━━━━━━━━━━━━━━━━━
          发货单
━━━━━━━━━━━━━━━━━━━━━━

订单号: ORD1234567890

┌─ 收货信息 ─────────────┐
│ 收件人：张三             │
│ 联系电话：13800138000    │
│ 收货地址：               │
│ 广东省深圳市南山区        │
│ 科技园南路1号            │
└─────────────────────────┘

┌─ 商品明细 ─────────────┐
│ 1.长粒香（10斤/袋）      │
│    数量：2袋 ，总重：20斤 │
│                         │
│ 2.稻花香（10斤/箱）      │
│    数量：1箱 ，总重：10斤 │
└─────────────────────────┘

┌─ 总计信息 ─────────────┐
│ 商品总数：3 份           │
│ 商品总重：30 斤          │
└─────────────────────────┘

* 请核对商品数量和收货地址
下单时间: 2025-10-16 10:30:00
```

#### 导出发货单
1. 进入"我的"页面
2. 找到目标订单
3. 点击"📋 发货单"按钮
4. 自动生成并保存到相册

### 6. 运费智能计算系统

#### 计算规则
采用**基于省份**的运费配置系统，根据收货地址所在省份和商品总重量自动计算运费

#### 运费配置表
**完整配置** (`utils/shippingConfig.js`)：

**东北地区** - 1.0元/斤
- 黑龙江省
- 吉林省
- 辽宁省

**华北地区** - 1.2元/斤
- 北京市
- 天津市
- 河北省
- 山西省
- 内蒙古自治区
- 山东省
- 河南省

**华东地区** - 1.4元/斤
- 上海市
- 江苏省
- 浙江省
- 安徽省
- 福建省
- 江西省

**华中地区** - 1.4元/斤
- 湖北省
- 湖南省

**华南地区** - 1.4元/斤
- 广东省
- 广西壮族自治区
- 海南省

**西南地区** - 1.4元/斤
- 重庆市
- 四川省
- 贵州省
- 云南省

**西北地区** - 1.4元/斤
- 陕西省
- 甘肃省
- 宁夏回族自治区

**偏远地区** - 5.4元/斤
- 西藏自治区
- 青海省
- 新疆维吾尔自治区

**特别行政区** - 1.4元/斤
- 香港特别行政区
- 澳门特别行政区
- 台湾省

#### 计算公式
```
运费 = 总重量(斤) × 运费单价(元/斤)
```

#### 计算示例
**示例1：东北地区**
```
商品：稻花香 3袋 × 10斤 = 30斤
地址：黑龙江省哈尔滨市
运费单价：1.0元/斤
运费总计：30 × 1.0 = 30元
```

**示例2：华北地区**
```
商品：长粒香 4箱 × 10斤 = 40斤
地址：北京市朝阳区
运费单价：1.2元/斤
运费总计：40 × 1.2 = 48元
```

**示例3：偏远地区**
```
商品：稻花香 2袋 × 10斤 = 20斤
地址：西藏自治区拉萨市
运费单价：5.4元/斤
运费总计：20 × 5.4 = 108元
```

#### 实时计算
- **选择地址时** - 自动计算并显示运费
- **更换地址时** - 实时更新运费和总价
- **结算页面** - 明细显示运费单价和总计

#### 自定义运费配置
修改 `utils/shippingConfig.js` 文件：

```javascript
const SHIPPING_RATES = {
  '黑龙江省': 1.0,
  '吉林省': 1.0,
  '辽宁省': 1.0,
  '北京市': 1.2,
  // ... 添加或修改省份运费
};

// 默认运费（未配置省份使用）
const DEFAULT_SHIPPING_RATE = 1.4;
```

#### 运费查询
用户可在"我的" → "运费标准"页面查看完整运费配置表

---

## 使用指南

### 商家使用流程

#### 日常销售
```
1. 接收客户订单
   ↓
2. 小程序中添加商品数量
   ↓
3. 填写收货地址（可粘贴客户发来的地址）
   ↓
4. 提交订单
   ↓
5. 导出发货单图片
   ↓
6. 发送给仓库/物流
```

#### 管理商品
```
1. 点击工具图标（⚙）
   ↓
2. 选择"添加品种"添加新商品
   或
   选择"编辑商品"删除商品
   或
   选择"恢复默认"重置商品
```

#### 查看历史
```
1. 切换到"我的"标签
   ↓
2. 查看所有历史订单
   ↓
3. 点击"查看详情"查看订单信息
   或
   点击"📥 订单"导出完整订单
   或
   点击"📋 发货单"导出发货单
```

### 客户使用流程

```
1. 浏览商品
   ↓
2. 点击 +/- 选择数量
   ↓
3. 点击"去结算"
   ↓
4. 添加收货地址
   ↓
5. 确认订单信息
   ↓
6. 提交订单
```

---

## 技术实现

### 技术栈
- **框架**：微信小程序原生开发
- **语言**：JavaScript
- **样式**：WXSS（类CSS）
- **存储**：云端数据库（MySQL）
- **API**：RESTful 接口调用
- **Canvas**：Canvas 2D API

### 核心技术

#### 1. Canvas动态高度计算

**原理**：
```javascript
// 1. 智能预估初始高度
const estimatedHeight = Math.max(3000, 800 + products.length * 100)

// 2. 第一次绘制，获取实际高度
canvas.height = estimatedHeight * dpr
const actualHeight = await drawContent(ctx, order, estimatedHeight)

// 3. 使用实际高度重新绘制
canvas.height = actualHeight * dpr
await drawContent(ctx, order, actualHeight)
```

**优势**：
- 自动适应内容
- 确保完整显示
- 节省内存

#### 2. 地址智能识别算法

**识别流程**：
```
输入文本
  ↓
清理格式（去除空格、换行）
  ↓
提取姓名（2-4个汉字）
  ↓
提取电话（11位数字）
  ↓
提取省市区（正则匹配）
  ↓
提取详细地址（剩余部分）
  ↓
返回结构化数据
```

**关键代码结构**：
```javascript
function parseAddress(text) {
  // 1. 清理文本
  let cleanText = text.replace(/\s+/g, '')
  
  // 2. 提取姓名
  const nameMatch = cleanText.match(/^[\u4e00-\u9fa5]{2,4}/)
  
  // 3. 提取电话
  const phoneMatch = cleanText.match(/1[3-9]\d{9}/)
  
  // 4. 提取省市区
  const addressMatch = parseRegion(cleanText)
  
  // 5. 组装结果
  return {
    name, phone, province, city, district, detail
  }
}
```

#### 3. 文字智能换行

**实现原理**：
```javascript
function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
  const words = text.split('')
  let line = ''
  let lineCount = 0
  
  for (let char of words) {
    const testLine = line + char
    const metrics = ctx.measureText(testLine)
    
    if (metrics.width > maxWidth && line) {
      ctx.fillText(line, x, y + lineCount * lineHeight)
      line = char
      lineCount++
    } else {
      line = testLine
    }
  }
  
  ctx.fillText(line, x, y + lineCount * lineHeight)
  return lineCount + 1  // 返回行数
}
```

**特点**：
- 逐字测量宽度
- 超宽自动换行
- 返回实际行数
- 动态调整间距

#### 4. 云端数据管理

**数据结构**：
```javascript
// 商品数据 - 通过 GET /api/products 获取
{
  id: 1,
  name: '长粒香',
  price: 88,
  unit: '袋',
  weight: 10,
  image: 'https://example.com/image.jpg'
}

// 订单数据 - 通过 GET /api/orders 获取
{
  id: 1234567890,
  orderNumber: 'ORD1234567890',
  products: [...],
  address: {...},
  totalPrice: 180,
  totalWeight: 60,
  shippingRate: 1.0,
  totalShipping: 120,
  grandTotal: 300,
  status: '待发货',
  paymentStatus: '未付款',
  createdAt: '2025-10-16 10:30:00'
}

// 地址数据 - 通过 GET /api/addresses 获取
{
  id: 1,
  name: '张三',
  phone: '13800138000',
  province: '广东省',
  city: '深圳市',
  district: '南山区',
  detail: '科技园南路1号',
  isDefault: true
}
```

**存储API**：
- **商品管理**: `/api/products` - CRUD 操作
- **订单管理**: `/api/orders` - 订单创建、查询、更新、删除
- **地址管理**: `/api/addresses` - 地址CRUD操作
- **运费计算**: `/api/shipping/calculate` - 运费API计算

**数据特点**：
- ✅ 实时同步到云端数据库
- ✅ 多端数据一致性
- ✅ 自动备份和恢复
- ✅ 高可用性和数据安全
#### API 调用示例

```javascript
// API 管理工具
const apiManager = require('../../utils/apiManager.js')

// 获取商品列表
const products = await apiManager.productManager.getProducts()

// 创建订单
const order = await apiManager.orderManager.createOrder(orderData)

// 获取地址列表
const addresses = await apiManager.addressManager.getAddresses()

// 计算运费
const shipping = await apiManager.shippingManager.calculateShipping(province, weight)
```

### 性能优化

#### 1. Canvas优化
- 使用transform代替top/left
- 启用硬件加速
- 智能预估高度减少重绘

#### 2. 动画优化
- 使用CSS3 transition
- 贝塞尔曲线缓动
- 60fps流畅动画

#### 3. 事件优化
- 防止重复点击
- 节流和防抖
- 事件委托

---

## 测试用例

### 地址识别测试

#### 测试用例1：标准格式
**输入**：
```
张三 13800138000
广东省深圳市南山区科技园南路1号
```
**预期输出**：
- 姓名：张三
- 电话：13800138000
- 省：广东省
- 市：深圳市
- 区：南山区
- 详细：科技园南路1号

#### 测试用例2：紧凑格式
**输入**：
```
李四13900139000广东广州天河区天河路100号
```
**预期输出**：
- 姓名：李四
- 电话：13900139000
- 省：广东省
- 市：广州市
- 区：天河区
- 详细：天河路100号

#### 测试用例3：超长地址
**输入**：
```
王五 13700137000
北京市朝阳区建国路88号SOHO现代城A座12层1201室
```
**预期输出**：
- 地址自动换行
- 不会重叠
- 完整显示

### Canvas高度测试

#### 测试场景1：少量商品
- 商品数：1-2个
- 预期：完整显示，高度约600-800px

#### 测试场景2：中等商品
- 商品数：5-8个
- 预期：完整显示，高度约1300-1600px

#### 测试场景3：大量商品
- 商品数：10-15个
- 预期：完整显示，高度约1800-2300px

#### 测试场景4：极端情况
- 商品数：20个以上
- 长地址：超过80字
- 预期：高度自动调整，完整显示

---

## 常见问题

### Q1：商品图片不显示？
**原因**：外部图片链接失效
**解决**：
1. 使用默认SVG图片
2. 或从相册选择本地图片

### Q2：地址识别不准确？
**原因**：地址格式不标准
**解决**：
1. 使用标准格式：姓名 + 电话 + 地址
2. 手动修正识别结果
3. 参考地址格式示例

### Q3：订单图片不完整？
**原因**：（已修复）Canvas高度不足
**解决**：v2.3版本已实现动态高度，确保完整显示

### Q4：如何批量删除商品？
**步骤**：
1. 点击工具图标
2. 选择"编辑商品"
3. 依次点击要删除的商品
4. 完成后点击"完成编辑"

### Q5：运费如何计算？
**规则**：
- 根据收货地址省份和商品总重量
- 不同省份运费单价不同
- 公式：运费 = 总重量 × 运费单价

### Q6：能否自定义运费？
**方法**：
修改 `utils/shippingConfig.js` 文件中的运费配置

### Q7：如何导出多个订单？
**当前**：逐个导出
**未来**：计划添加批量导出功能

### Q8：数据会丢失吗？
**保障**：
- 所有数据保存在云端数据库
- 卸载小程序后数据仍然保留
- 数据实时同步，支持多端访问
- 自动备份和恢复机制

---

## 版本历史

### v2.4 (2025-10-17) 🚀 系统级更新

#### 订单管理系统 (重大升级)
- ✅ 订单状态筛选（待付款/待发货/已发货）
- ✅ 订单搜索功能（按姓名或电话）
- ✅ 快递单号管理（发货时添加，支持编辑）
- ✅ 多选订单功能（批量统计金额）
- ✅ 批量删除功能（支持批量删除订单）
- ✅ 订单详情页（独立页面显示）
- ✅ 订单状态流转（待付款→待发货→已发货）

#### 云端存储系统 (重大升级)
- ✅ 所有数据迁移到云端数据库
- ✅ 实时API接口调用
- ✅ 运费通过API动态计算
- ✅ 多端数据同步
- ✅ 自动备份和恢复

#### 运费计算系统 (完整重构)
- ✅ 基于省份的运费配置（34个省市自治区）
- ✅ 分区域运费标准（东北/华北/华东等7大区域）
- ✅ 实时运费计算（选择地址时自动计算）
- ✅ 运费标准页面（完整配置表展示）
- ✅ 偏远地区差异化运费（西藏/青海/新疆 5.4元/斤）

#### 地址识别增强 v2.2
- ✅ 无序识别（支持任意顺序的姓名、电话、地址）
- ✅ 6种姓名提取策略（识别率大幅提升）
- ✅ 直辖市优化（正确处理北京/天津/上海/重庆）
- ✅ 遮蔽号码支持（识别并提示修改 138****0000）
- ✅ 多格式支持（标签格式、紧凑格式等）

#### 数据管理优化
- ✅ 本地存储数据自动修复
- ✅ 旧图片链接自动替换为SVG
- ✅ 数据结构自动升级
- ✅ 订单状态空格清理

#### 用户体验提升
- ✅ 订单页面标题动态显示
- ✅ 智能粘贴键盘遮挡优化
- ✅ 付款状态选择（结算页）
- ✅ 订单更多菜单（导出、分享、编辑）

#### 技术改进
- ✅ Canvas动态高度优化
- ✅ 文字智能换行算法
- ✅ 性能优化（减少重绘）

### v2.3 (2025-10-16) 界面与体验优化

#### 界面优化
- ✅ 顶部导航栏下拉菜单
- ✅ 商品编辑模式（防误删）
- ✅ 工具图标动画效果

#### 功能增强
- ✅ Canvas动态高度计算
- ✅ 商品明细格式优化
- ✅ 发货单总计信息优化
- ✅ 价格显示格式统一

#### 技术改进
- ✅ 文字智能换行
- ✅ 动态间距调整

### v2.2 (2025-10) 发货单与地址识别

#### 发货单功能
- ✅ 新增发货单导出
- ✅ 两种导出方式（完整/发货单）
- ✅ 不含价格信息版本

#### 地址识别增强
- ✅ 支持更多地址格式
- ✅ 提升识别准确率
- ✅ 优化识别算法

#### 商品明细优化
- ✅ 显示单位信息
- ✅ 显示重量信息
- ✅ 格式更清晰

### v2.1 (2025-09) 基础功能完善

#### 基础功能
- ✅ 商品管理（添加/编辑/删除）
- ✅ 购物车功能
- ✅ 订单管理
- ✅ 地址管理
- ✅ 本地存储

#### UI美化
- ✅ 淘宝风格设计
- ✅ 渐变色导航栏
- ✅ 卡片式布局
- ✅ 流畅动画效果

---

## 项目结构

```
LLX-SmallProgram/
├── pages/                    # 页面目录
│   ├── index/                # 商品首页
│   │   ├── index.js          # 商品管理、购物车逻辑
│   │   ├── index.wxml        # 商品列表、下拉菜单
│   │   ├── index.wxss        # 商品卡片、动画样式
│   │   └── index.json        # 页面配置
│   ├── checkout/             # 结算页面
│   │   ├── checkout.js       # 地址选择、付款状态、下单逻辑
│   │   ├── checkout.wxml     # 结算明细、地址显示
│   │   ├── checkout.wxss     # 结算页面样式
│   │   └── checkout.json     # 页面配置
│   ├── orders/               # 订单管理页面
│   │   ├── orders.js         # 订单列表、筛选、搜索、导出逻辑
│   │   ├── orders.wxml       # 订单卡片、状态显示
│   │   ├── orders.wxss       # 订单列表样式
│   │   └── orders.json       # 页面配置
│   ├── order-detail/         # 订单详情页面（新增）
│   │   ├── order-detail.js   # 订单详情数据加载
│   │   ├── order-detail.wxml # 订单详细信息展示
│   │   ├── order-detail.wxss # 详情页样式
│   │   └── order-detail.json # 页面配置
│   ├── address/              # 地址管理页面
│   │   ├── address.js        # 地址列表、智能识别、编辑逻辑
│   │   ├── address.wxml      # 地址卡片、智能粘贴弹窗
│   │   ├── address.wxss      # 地址列表样式
│   │   └── address.json      # 页面配置
│   ├── shipping/             # 运费标准页面（新增）
│   │   ├── shipping.js       # 运费配置展示
│   │   ├── shipping.wxml     # 运费标准表格
│   │   ├── shipping.wxss     # 运费页面样式
│   │   └── shipping.json     # 页面配置
│   └── my/                   # 我的页面
│       ├── my.js             # 订单统计、导航逻辑
│       ├── my.wxml           # 订单状态卡片、功能菜单
│       ├── my.wxss           # 我的页面样式
│       └── my.json           # 页面配置
├── utils/                    # 工具库
│   ├── addressParser.js      # 地址智能识别算法（增强版v2.2）
│   ├── shippingConfig.js     # 运费配置系统（34省份）
│   └── util.js              # 通用工具函数
├── images/                   # 图片资源
│   ├── tab-icons/           # 底部导航图标
│   └── README.md            # 图片说明
├── server/                   # 后端服务文档（新增）
│   ├── 后端服务设计方案.md    # 后端技术方案
│   ├── 数据库初始化脚本.sql  # PostgreSQL数据库脚本
│   ├── docker-compose.yml   # Docker编排配置
│   ├── Dockerfile           # Docker镜像构建
│   ├── DEPLOYMENT.md        # 部署指南
│   └── README-Backend.md    # 后端项目说明
├── readme/                   # 项目说明文档
│   ├── 【林龍香大米商城完整文档】v2.4.md
│   └── 各种功能完成记录.txt
├── app.js                   # 应用入口
├── app.json                 # 应用配置（页面路由、tabBar）
├── app.wxss                # 全局样式
├── project.config.json      # 项目配置
└── sitemap.json            # 搜索索引配置
```

### 核心文件说明

#### 商品管理
- `pages/index/index.js` - 商品CRUD、本地存储、SVG图片修复
- 支持自定义商品、恢复默认、编辑模式

#### 地址识别
- `utils/addressParser.js` - 6种策略识别姓名、电话、地址
- 支持任意顺序、直辖市优化、遮蔽号码识别

#### 运费系统
- `utils/shippingConfig.js` - 34个省份运费配置
- 7大区域差异化运费标准

#### 订单系统
- `pages/orders/orders.js` - 状态筛选、搜索、多选、导出
- `pages/order-detail/order-detail.js` - 独立详情页
- 支持快递单号管理、状态流转

#### Canvas绘制
- `pages/checkout/checkout.js` - 动态高度计算
- `pages/orders/orders.js` - 订单图片、发货单导出
- 智能换行、行数计算

---

## 开发说明

### 修改运费配置

编辑 `utils/shippingConfig.js`：

```javascript
const shippingRates = {
  '广东省': 1.5,
  '北京市': 2.0,
  '上海市': 2.0,
  // 添加更多省份...
  'default': 2.5
}
```

### 修改默认商品

编辑 `pages/index/index.js` 中的 `getDefaultProducts()` 方法：

```javascript
getDefaultProducts() {
  return [
    {
      id: 1,
      name: '商品名称',
      price: 30,
      unit: '袋',
      weight: 10,
      image: '...',
      quantity: 0
    }
  ]
}
```

### 自定义主题色

编辑 `app.wxss`：

```css
:root {
  --primary-color: #ff6034;
  --secondary-color: #ee0a24;
}
```

---

## 注意事项

### 1. 数据备份
- 小程序数据保存在本地
- 卸载会清除所有数据
- 重要订单建议及时导出

### 2. 图片选择
- 支持从相册选择图片
- 推荐使用SVG默认图片
- 外部链接可能失效

### 3. 地址识别
- 建议使用标准格式
- 识别后检查准确性
- 可手动修正错误

### 4. Canvas限制
- iOS最大16384px
- Android最大8192px
- 单个订单建议不超过30个商品

---

## 技术支持

### 遇到问题？

1. **查看文档**：先查看本文档相关章节
2. **检查日志**：查看微信开发者工具控制台
3. **重启小程序**：关闭后重新打开
4. **清除缓存**：开发工具中清除缓存数据

### 常见错误处理

**Canvas生成失败**
```javascript
// 检查Canvas节点是否存在
if (!res || !res[0]) {
  console.error('Canvas节点未找到')
  return
}
```

**地址识别失败**
```javascript
// 检查输入文本
if (!addressText || addressText.length < 10) {
  console.error('地址文本过短')
  return
}
```

---

## 未来规划

### 短期计划
- [ ] 批量导出订单
- [ ] 订单搜索功能
- [ ] 统计报表功能
- [ ] 客户管理功能

### 长期计划
- [ ] 云端数据同步
- [ ] 多商家支持
- [ ] 会员系统
- [ ] 优惠券功能
- [ ] 支付接口对接

---

## 致谢

感谢所有使用和支持本项目的用户！

如有任何问题或建议，欢迎反馈。

---

## 许可证

本项目仅供学习和参考使用。

---

**文档版本**：v2.4  
**最后更新**：2025年10月17日  
**维护状态**：✅ 活跃维护中

---

© 2025 林龍香大米商城 All Rights Reserved.

