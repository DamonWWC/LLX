# 收货地址功能说明

## 🎉 新增功能总览

### v2.3 - 收货地址版（2025-10-15）

本次更新添加了完整的收货地址管理功能，参考淘宝、京东等主流电商APP的设计。

## ✨ 核心功能

### 1. 收货地址管理页面

**访问方式：**
- 点击结算面板的"选择收货地址"
- 从底部购物车点击"立即结算"

**主要功能：**
- ✅ 查看所有保存的收货地址
- ✅ 添加新地址
- ✅ 编辑现有地址
- ✅ 删除地址
- ✅ 设置默认地址
- ✅ 选择地址（结算时）

### 2. 智能粘贴识别

**功能描述：**
自动识别粘贴的地址信息，快速填充表单。

**使用方法：**
1. 点击"智能识别粘贴"按钮
2. 粘贴完整的地址信息
3. 点击"智能识别"按钮
4. 自动填充到表单

**支持识别：**
- ✅ 收件人姓名（2-4个中文字符）
- ✅ 手机号码（11位）
- ✅ 省份（如：北京市、广东省）
- ✅ 城市（如：北京市、广州市）
- ✅ 区县（如：朝阳区、天河区）
- ✅ 详细地址（剩余部分）

**示例格式：**
```
张三 13800138000
北京市朝阳区建国路100号
```

或

```
李四 15900000000 广东省 广州市 天河区 天河路123号
```

### 3. 地址本地存储

**存储机制：**
- 所有地址保存在本地
- 无需服务器
- 完全保护隐私
- 下次打开自动加载

**存储内容：**
- 收件人姓名
- 手机号码
- 省份、城市、区县
- 详细地址
- 是否默认地址

### 4. 结算流程

**新流程：**
1. 选择商品 → 调整数量
2. 点击"立即结算"
3. 显示结算详情面板
4. 选择收货地址
5. 确认订单信息
6. 点击"确认下单"

**地址选择：**
- 首次结算：提示"请选择收货地址"
- 已选择：显示完整地址信息
- 点击地址区域可更换

## 📱 界面设计

### 地址列表页

```
┌─────────────────────────────────────┐
│ 📍 收货地址                   [×]  │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ [默认]                          │ │
│ │ 张三  13800138000               │ │
│ │ 北京市朝阳区建国路100号         │ │
│ │ [编辑] [删除]                   │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 李四  15900000000               │ │
│ │ 广东省广州市天河区天河路123号   │ │
│ │ [编辑] [删除] [设为默认]       │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ [+ 添加新地址]                     │
└─────────────────────────────────────┘
```

### 结算详情面板

```
┌─────────────────────────────────────┐
│ 📋 结算详情                   [×]  │
├─────────────────────────────────────┤
│ 📍 收货地址          [更换 >]      │
│ 张三  13800138000                   │
│ 北京市朝阳区建国路100号             │
│ ─────────────────────────────────── │
│ 商品明细                            │
│ 东北大米 × 2        ¥199.8         │
│ ─────────────────────────────────── │
│ 商品总价            ¥179.8         │
│ 运费总计            ¥20.0          │
│ ════════════════════════════════════ │
│ 应付总额            ¥199.8         │
│                                     │
│ [📷 保存订单]  [确认下单]          │
└─────────────────────────────────────┘
```

### 添加/编辑地址

```
┌─────────────────────────────────────┐
│ 添加地址                      [×]  │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 📋 智能识别粘贴               │ │
│ │ 支持识别姓名、电话、地址       │ │
│ └─────────────────────────────────┘ │
│                                     │
│ * 收件人                            │
│ [输入框]                            │
│                                     │
│ * 手机号                            │
│ [输入框]                            │
│                                     │
│ * 省份                              │
│ [输入框]                            │
│                                     │
│ * 城市                              │
│ [输入框]                            │
│                                     │
│ 区/县                               │
│ [输入框]                            │
│                                     │
│ * 详细地址                          │
│ [文本域]                            │
│                                     │
│ □ 设为默认地址                      │
│                                     │
│ [取消]            [保存]            │
└─────────────────────────────────────┘
```

## 🎯 使用流程

### 添加地址

#### 方式一：手动输入
1. 打开地址管理页面
2. 点击"添加新地址"
3. 依次填写各项信息
4. 勾选"设为默认"（可选）
5. 点击"保存"

#### 方式二：智能识别
1. 打开添加地址弹窗
2. 点击"智能识别粘贴"
3. 粘贴完整地址信息
4. 点击"智能识别"
5. 检查自动填充的信息
6. 补充或修改信息
7. 点击"保存"

### 管理地址

**编辑地址：**
1. 在地址列表找到要编辑的地址
2. 点击"编辑"按钮
3. 修改信息
4. 点击"保存"

**删除地址：**
1. 点击"删除"按钮
2. 确认删除操作
3. 地址被移除

**设置默认：**
1. 点击"设为默认"按钮
2. 该地址成为默认地址
3. 其他地址取消默认状态

### 结算下单

1. **选择商品：** 在首页选择大米，调整数量
2. **去结算：** 点击底部"立即结算"按钮
3. **选择地址：** 点击"选择收货地址"
4. **选择地址：** 在地址列表点击要使用的地址
5. **确认信息：** 查看商品明细和地址
6. **确认下单：** 点击"确认下单"按钮
7. **完成订单：** 显示订单确认信息

## 💾 数据存储

### 存储键名
- `addressList` - 地址列表数组

### 数据结构
```javascript
{
  id: 1234567890,           // 唯一标识（时间戳）
  name: "张三",             // 收件人
  phone: "13800138000",     // 手机号
  province: "北京市",       // 省份
  city: "北京市",           // 城市
  district: "朝阳区",       // 区县
  detail: "建国路100号",    // 详细地址
  isDefault: true           // 是否默认
}
```

### 存储时机
- ✅ 添加地址
- ✅ 编辑地址
- ✅ 删除地址
- ✅ 设置默认

### 加载时机
- ✅ 打开地址页面
- ✅ 小程序启动（后台加载）

## 🎨 设计特点

### 电商风格
- 卡片式地址展示
- 默认标签红色突出
- 地址信息清晰分层
- 操作按钮分组明确

### 交互优化
- 点击地址卡片选择（结算时）
- 长按无操作（避免误触）
- 编辑、删除独立按钮
- 确认提示防止误操作

### 视觉层次
- 默认地址：红色标签 + 独特样式
- 普通地址：白色卡片
- 空状态：图标 + 提示文字
- 底部固定：添加按钮始终可见

## ⚡ 智能识别算法

### 识别规则

**姓名识别：**
- 位置：通常在开头
- 规则：2-4个中文字符
- 正则：`/^([^0-9]{2,4})/`

**手机号识别：**
- 规则：11位，1开头
- 正则：`/1[3-9]\d{9}/`

**省份识别：**
- 关键词：省、自治区、特别行政区
- 正则：`/([\u4e00-\u9fa5]{2,}?省|[\u4e00-\u9fa5]{2,}?自治区|...)/`

**城市识别：**
- 关键词：市、地区、自治州
- 正则：`/([\u4e00-\u9fa5]{2,}?市|[\u4e00-\u9fa5]{2,}?地区|...)/`

**区县识别：**
- 关键词：区、县、旗
- 正则：`/([\u4e00-\u9fa5]{2,}?区|[\u4e00-\u9fa5]{2,}?县|...)/`

**详细地址：**
- 剩余所有文本
- 去除已识别的部分

### 识别准确率

| 信息类型 | 准确率 | 说明 |
|---------|--------|------|
| 手机号 | 95%+ | 11位数字易识别 |
| 姓名 | 85%+ | 2-4字中文较准确 |
| 省份 | 90%+ | 关键词明确 |
| 城市 | 90%+ | 关键词明确 |
| 区县 | 80%+ | 可能与城市混淆 |
| 详细地址 | 70%+ | 需要人工检查 |

## 📝 注意事项

### 地址输入
- 收件人、手机号、省市、详细地址为必填项
- 手机号必须是11位有效号码
- 建议完整填写省市区信息

### 智能识别
- 识别后请检查信息准确性
- 特别注意详细地址的完整性
- 复杂地址建议手动输入

### 默认地址
- 首个添加的地址自动设为默认
- 只能有一个默认地址
- 设置新默认会取消旧默认

### 数据备份
- 地址保存在本地
- 卸载小程序会丢失
- 建议定期截图备份

## 🔒 隐私安全

- ✅ 所有数据仅存储在用户设备
- ✅ 不上传到任何服务器
- ✅ 完全保护用户隐私
- ✅ 符合单机版设计理念

## 🎊 更新内容

### 新增页面
- `pages/address/address` - 收货地址管理页面

### 修改页面
- `pages/index/index` - 添加地址选择和确认下单

### 新增功能
- 地址增删改查
- 智能粘贴识别
- 地址本地存储
- 默认地址管理
- 结算流程优化

### UI 优化
- 地址卡片设计
- 默认标签样式
- 智能识别提示
- 结算面板布局

## 📊 功能对比

| 功能 | v2.2（上一版） | v2.3（当前版） |
|------|---------------|---------------|
| 商品管理 | ✅ | ✅ |
| 图片上传 | ✅ | ✅ |
| 本地存储 | ✅ | ✅ |
| 收货地址 | ❌ | ✅ |
| 智能识别 | ❌ | ✅ |
| 确认下单 | ❌ | ✅ |

---

**完成时间：** 2025-10-15  
**版本：** v2.3（收货地址版）  
**参考：** 淘宝、京东、拼多多等主流电商APP

