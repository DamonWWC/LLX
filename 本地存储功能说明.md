# 本地存储功能说明

## 🎉 新增功能

### 1. 📷 图片上传功能

**功能描述：**
- 用户可以从手机相册选择图片
- 支持拍照上传
- 自动压缩图片，节省空间

**使用方法：**
1. 点击"+ 添加品种"按钮
2. 在弹窗中点击"商品图片"区域
3. 选择"从相册选择"或"拍照"
4. 选择/拍摄图片后自动显示预览

**技术实现：**
- 使用 `wx.chooseImage` API
- 压缩模式：`sizeType: ['compressed']`
- 来源：`sourceType: ['album', 'camera']`
- 图片存储为临时文件路径

### 2. 💾 本地存储功能

**功能描述：**
- 所有商品数据自动保存到本地
- 下次打开小程序自动加载数据
- 无需服务器，完全单机运行

**存储内容：**
- 商品名称
- 商品价格
- 运费
- 商品图片（临时路径）
- 购物车数量

**存储时机：**
- ✅ 添加新商品时
- ✅ 删除商品时
- ✅ 修改商品数量时（+/-按钮）
- ✅ 清空购物车时
- ✅ 恢复默认商品时

**技术实现：**
- 使用 `wx.setStorageSync` 保存数据
- 使用 `wx.getStorageSync` 读取数据
- 存储键名：`riceProducts`
- 数据格式：JSON 数组

### 3. 🔄 恢复默认商品功能

**功能描述：**
- 一键恢复到初始的3种大米商品
- 清除所有自定义商品

**使用方法：**
1. 点击顶部导航栏的"恢复默认"按钮
2. 确认操作
3. 自动恢复默认商品并保存

**默认商品：**
1. 东北大米 - ¥89.9 + 运费¥10
2. 泰国香米 - ¥128 + 运费¥15
3. 五常稻花香 - ¥158 + 运费¥12

## 📱 使用流程

### 首次使用
1. 打开小程序 → 自动加载默认3种商品
2. 数据自动保存到本地

### 添加自定义商品
1. 点击"+ 添加品种"
2. 点击图片区域 → 选择/拍摄图片
3. 输入商品名称、价格、运费
4. 点击"确定" → 自动保存到本地

### 再次打开
1. 自动从本地加载上次的数据
2. 包括自定义商品和购物车数量

### 恢复初始状态
1. 点击"恢复默认"按钮
2. 确认后清除所有自定义商品
3. 恢复到初始的3种商品

## 🔧 技术细节

### 数据结构
```javascript
{
  id: 1,                    // 唯一标识
  name: '东北大米',         // 商品名称
  price: 89.9,             // 价格
  shipping: 10,            // 运费
  image: 'xxx',            // 图片路径
  quantity: 0              // 购物车数量
}
```

### 存储容量
- 微信小程序单个 key 限制：10MB
- 总存储限制：10MB
- 足够存储数百个商品信息

### 图片存储说明
⚠️ **重要提示：**
- 上传的图片存储为**临时文件路径**
- 临时文件在小程序关闭后可能被清理
- 建议：使用默认图片或网络图片URL

### 持久化存储方案
如需长期保存上传的图片，可以：
1. 将图片上传到云存储（需要云开发）
2. 使用 `wx.saveFile` 保存为本地文件
3. 使用默认的网络图片URL

## ⚡ 优化建议

### 当前实现（单机版）
✅ 优点：
- 无需服务器
- 完全离线运行
- 响应速度快
- 零成本

⚠️ 限制：
- 数据仅保存在当前设备
- 卸载小程序后数据丢失
- 无法多设备同步
- 临时图片可能失效

### 未来升级方案
如需要，可以升级为云存储版本：
- 使用微信云开发
- 图片上传到云存储
- 数据存储到云数据库
- 支持多设备同步

## 📝 注意事项

1. **图片选择权限**
   - 首次使用需要授权访问相册
   - 如果拒绝授权，可以使用默认图片

2. **数据备份**
   - 建议定期截图保存商品信息
   - 或导出为图片（使用保存订单功能）

3. **存储清理**
   - 可以随时使用"恢复默认"清理数据
   - 或删除不需要的商品

4. **性能优化**
   - 建议控制商品数量在100个以内
   - 图片自动压缩，无需担心性能

## 🎯 使用场景

### 适用场景
✅ 个人使用记录大米价格
✅ 小店铺管理商品信息
✅ 临时计算价格和运费
✅ 无网络环境下使用

### 不适用场景
❌ 多人协作使用（无同步功能）
❌ 大量商品数据（建议<100个）
❌ 需要永久保存图片（临时路径会失效）

## 🔒 数据安全

- 所有数据仅存储在用户设备本地
- 不上传到任何服务器
- 完全保护用户隐私
- 符合单机版设计理念

## 📊 功能对比

| 功能 | 单机版（当前） | 云开发版（可升级） |
|------|---------------|-------------------|
| 本地存储 | ✅ | ✅ |
| 图片上传 | ✅（临时） | ✅（永久） |
| 多设备同步 | ❌ | ✅ |
| 数据备份 | ❌ | ✅ |
| 需要服务器 | ❌ | ✅ |
| 使用成本 | 免费 | 收费 |

## 🎉 更新日志

### v2.2 - 本地存储版（2025-10-15）
- ✅ 添加图片上传功能（相册/拍照）
- ✅ 实现本地存储（自动保存/加载）
- ✅ 添加恢复默认商品功能
- ✅ 优化存储逻辑（增删改同步）
- ✅ 添加存储状态提示
- ✅ 完善错误处理

---

**完成时间：** 2025-10-15  
**版本：** v2.2（单机本地存储版）  
**特点：** 完全离线、零成本、保护隐私

