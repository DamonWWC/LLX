# 运费计算功能说明

## 🎯 功能概述

基于地区和重量的智能运费计算系统，支持全国34个省级行政区差异化运费。

---

## 📊 运费计算规则

### 基本公式
```
运费 = 商品总重量(斤) × 运费单价(元/斤)
```

### 示例
```
东北大米: 10斤/袋 × 2袋 = 20斤
黑龙江省运费单价: 0.8元/斤
运费 = 20斤 × 0.8元/斤 = 16元
```

---

## 🗺️ 运费标准

### 东北地区（低运费）
- 黑龙江省: 0.8元/斤
- 吉林省: 0.8元/斤
- 辽宁省: 0.9元/斤

### 华北地区
- 北京市: 1.2元/斤
- 天津市: 1.2元/斤
- 河北省: 1.0元/斤
- 山西省: 1.1元/斤
- 内蒙古: 1.3元/斤

### 华东地区（高运费）
- 上海市: 1.4元/斤 ⭐
- 江苏省: 1.3元/斤
- 浙江省: 1.3元/斤
- 安徽省: 1.2元/斤
- 福建省: 1.4元/斤
- 江西省: 1.2元/斤
- 山东省: 1.1元/斤

### 华中地区
- 河南省: 1.1元/斤
- 湖北省: 1.2元/斤
- 湖南省: 1.2元/斤

### 华南地区（高运费）
- 广东省: 1.4元/斤 ⭐
- 广西: 1.3元/斤
- 海南省: 1.8元/斤

### 西南地区
- 重庆市: 1.3元/斤
- 四川省: 1.2元/斤
- 贵州省: 1.4元/斤
- 云南省: 1.5元/斤
- 西藏: 2.5元/斤

### 西北地区
- 陕西省: 1.3元/斤
- 甘肃省: 1.5元/斤
- 青海省: 1.8元/斤
- 宁夏: 1.5元/斤
- 新疆: 2.0元/斤

### 港澳台地区
- 香港: 3.0元/斤
- 澳门: 3.0元/斤
- 台湾: 3.5元/斤

### 默认运费
- 未配置地区: 1.2元/斤

---

## 🔄 使用流程

### 1. 查看运费标准
```
我的页面 → 运费标准
```
- 查看全国所有省份的运费单价
- 支持搜索省份
- 查看运费区间说明

### 2. 自动计算运费
```
商品页面 → 立即结算 → 选择地址
```
- 选择地址后自动计算运费
- 根据省份匹配运费单价
- 根据商品总重量计算运费
- 实时显示运费明细

### 3. 订单详情显示
```
我的订单 → 查看详情
```
- 显示商品总价
- 显示总重量
- 显示运费单价和运费
- 显示实付款

---

## 💡 计算示例

### 示例1: 东北发货（低运费）
```
商品：
- 东北大米 10斤/袋 × 2袋 = 20斤
- 价格：89.9元/袋 × 2 = 179.8元

收货地址：黑龙江省哈尔滨市
运费单价：0.8元/斤

计算：
商品总价：179.8元
运费：20斤 × 0.8元/斤 = 16元
实付款：179.8 + 16 = 195.8元
```

### 示例2: 华东发货（高运费）
```
商品：
- 泰国香米 10斤/袋 × 3袋 = 30斤
- 价格：128元/袋 × 3 = 384元

收货地址：上海市浦东新区
运费单价：1.4元/斤

计算：
商品总价：384元
运费：30斤 × 1.4元/斤 = 42元
实付款：384 + 42 = 426元
```

### 示例3: 混合商品
```
商品：
- 东北大米 10斤/袋 × 1袋 = 10斤
- 五常稻花香 10斤/袋 × 2袋 = 20斤
- 总重量：30斤
- 总价：89.9 + 158×2 = 405.9元

收货地址：广东省深圳市
运费单价：1.4元/斤

计算：
商品总价：405.9元
运费：30斤 × 1.4元/斤 = 42元
实付款：405.9 + 42 = 447.9元
```

---

## 📱 页面功能

### 结算页面
- ✅ 显示商品总价
- ✅ 显示商品总重量
- ✅ 显示运费单价（根据省份）
- ✅ 显示运费金额
- ✅ 显示应付总额
- ✅ 选择地址后自动更新运费

### 运费标准页面
- ✅ 列表显示所有省份运费
- ✅ 按运费从低到高排序
- ✅ 支持搜索省份
- ✅ 查看运费区间说明
- ✅ 实时查询任意省份运费

### 订单详情
- ✅ 显示订单运费信息
- ✅ 显示运费单价
- ✅ 显示总重量
- ✅ 兼容旧订单（无运费信息）

---

## 🔧 技术实现

### 核心文件
**utils/shippingConfig.js**
- 运费配置管理模块
- 34个省份运费数据
- 运费计算函数
- 配置查询接口

### 关键函数

#### 1. 获取运费单价
```javascript
getShippingRate(province)
// 输入：省份名称
// 输出：运费单价（元/斤）
```

#### 2. 计算运费
```javascript
calculateShipping(totalWeight, province)
// 输入：总重量、省份
// 输出：{rate, totalWeight, shipping, province}
```

#### 3. 获取所有配置
```javascript
getAllShippingRates()
// 输出：所有省份运费配置数组（按价格排序）
```

---

## 🎨 界面特点

### 结算页面
- 清晰的价格分项显示
- 运费单价实时显示
- 选择地址前提示"请先选择地址"
- 自动计算并更新总价

### 运费标准页面
- 渐变顶部导航
- 搜索功能
- 卡片式列表
- 醒目的价格显示
- 底部计算公式提示

---

## ✨ 优势特点

### 1. 智能计算
- ✅ 自动识别省份
- ✅ 自动匹配运费单价
- ✅ 实时计算运费
- ✅ 支持省份简称

### 2. 用户友好
- ✅ 价格明细透明
- ✅ 计算规则清晰
- ✅ 支持查询任意省份
- ✅ 提供区间说明

### 3. 数据完整
- ✅ 34个省级行政区全覆盖
- ✅ 考虑地区差异
- ✅ 东北低、沿海高、边远更高
- ✅ 符合实际物流情况

### 4. 可维护性
- ✅ 配置集中管理
- ✅ 易于修改和扩展
- ✅ 支持动态更新
- ✅ 代码模块化

---

## 🔍 兼容性

### 新旧数据兼容
- ✅ 新订单：完整显示运费信息
- ✅ 旧订单：兼容显示（无运费信息）
- ✅ 旧商品：自动升级数据结构
- ✅ 无缝过渡

### 数据结构
```javascript
// 旧结构
{
  price: 89.9,
  shipping: 10  // 固定运费
}

// 新结构
{
  price: 89.9,
  unit: '袋',
  weight: 10    // 重量，用于计算运费
}
```

---

## 📚 相关页面

1. **pages/shipping/** - 运费标准页面
   - shipping.js
   - shipping.wxml
   - shipping.wxss
   - shipping.json

2. **utils/shippingConfig.js** - 运费配置模块

3. **pages/checkout/** - 结算页面（已更新）

4. **pages/orders/** - 订单列表（已更新）

5. **pages/my/** - 我的页面（添加入口）

---

## 🎉 功能总结

✨ **运费计算系统特点：**
- 🌏 全国34省差异化运费
- 📦 基于重量精确计算
- 💰 价格透明，明细清晰
- 🔍 支持查询和搜索
- ✅ 自动计算，实时更新
- 📱 界面美观，易于使用

---

更新日期：2024-10-15
版本：v3.3
状态：✅ 已完成并可用

